<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>告白气球 - 我们的故事</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 配置Tailwind：统一响应式布局类 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            love: {
              light: '#FFD1DC',
              DEFAULT: '#FF69B4',
              dark: '#C71585',
              purple: '#DDA0DD',
              faded: '#F8BBD0'
            }
          },
          fontFamily: {
            romantic: ['"Dancing Script"', 'cursive', 'sans-serif'],
            lyric: ['"Noto Serif SC"', 'serif']
          }
        }
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }
      .heart-beat {
        animation: heartbeat 1.5s ease-in-out infinite;
      }
      .float {
        animation: float 6s ease-in-out infinite;
      }
      .fade-in {
        animation: fadeIn 1.5s ease-in forwards;
      }
      .slide-up {
        animation: slideUp 1s ease-out forwards;
      }
      .lyric-active {
        animation: lyricPulse 0.8s ease-in-out forwards;
      }
      .pulse {
        animation: pulse 2s infinite;
      }
      .petal {
        position: absolute;
        background-size: cover;
        pointer-events: none;
        opacity: 0.6;
        z-index: 0;
      }
    }
    
    @keyframes heartbeat {
      0% { transform: scale(1); }
      14% { transform: scale(1.1); }
      28% { transform: scale(1); }
      42% { transform: scale(1.1); }
      70% { transform: scale(1); }
    }
    
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
      100% { transform: translateY(0px); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes lyricPulse {
      from { opacity: 0.7; transform: scale(0.98); }
      to { opacity: 1; transform: scale(1); }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
  </style>
  
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
</head>

<body class="bg-gradient-to-b from-pink-50 to-purple-50 min-h-screen overflow-x-hidden">
  <!-- 音乐资源 -->
  <audio id="bgMusic" loop preload="auto">
    <source src="https://13703897128.github.io/lovestory.github.io/love.mp3" type="audio/mpeg">
  </audio>
  
  <!-- 花瓣装饰 -->
  <div id="petals-container" class="fixed inset-0 pointer-events-none z-0"></div>
  <div id="hearts-container" class="fixed inset-0 pointer-events-none z-0"></div>
  <div id="bubbles-container" class="fixed inset-0 pointer-events-none z-0"></div>

  <header class="relative pt-20 pb-16 px-6 text-center z-10">
    <h1 class="font-romantic text-[clamp(2.5rem,6vw,4rem)] text-love-dark font-bold mb-4 text-shadow fade-in">
      我们的第三年
    </h1>
    <p class="font-romantic text-[clamp(1.5rem,3vw,2rem)] text-love-purple fade-in" style="animation-delay: 0.5s">
      从2022.8.15的初见，到余生的每一个朝夕
    </p>
    <div class="mt-8 flex justify-center">
      <i class="fa fa-heart text-love text-4xl heart-beat"></i>
    </div>
    <p id="playTip" class="mt-4 text-gray-500 text-sm fade-in" style="animation-delay: 1s">
      让我们的旋律响起 ❤️
    </p>
  </header>

  <!-- 歌曲信息 -->
  <section class="relative z-10 max-w-3xl mx-auto px-6 mb-16 opacity-0" id="song-info">
    <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-6 md:p-10 shadow-lg border border-pink-100 flex flex-col items-center gap-8">
      <div class="w-48 h-48 rounded-xl overflow-hidden shadow-xl pulse">
        <img src="https://picsum.photos/id/1069/300/300" alt="告白气球专辑封面" class="w-full h-full object-cover">
      </div>
      <div class="text-center">
        <h2 id="song-title" class="font-romantic text-[clamp(2rem,5vw,3rem)] text-love-dark font-bold mb-2">
          告白气球
        </h2>
        <p class="text-gray-600 mb-4">专属我们的恋爱旋律</p>
        <p class="text-gray-500 text-sm max-w-md">
          这首歌是我们故事的序章，从塞纳河畔的邂逅，到三年间的朝朝暮暮。前奏响起时，仿佛又回到2022年8月的那个夏天，你的笑容比阳光更耀眼。
        </p>
        <p id="intro-tip" class="mt-4 text-love text-sm hidden">
          <i class="fa fa-music mr-1"></i>  我们的故事即将继续
        </p>
      </div>
    </div>
  </section>

  <!-- 歌词区域 -->
  <section class="relative z-10 max-w-2xl mx-auto px-6 mb-16 opacity-0" id="lyrics-section">
    <div class="bg-white/80 backdrop-blur-sm rounded-2xl p-6 md:p-10 shadow-lg border border-pink-100">
      <div id="lyrics-container" class="h-64 md:h-80 overflow-hidden flex items-center justify-center">
        <div id="lyrics-wrapper" class="text-center transition-transform duration-300 w-full">
          <!-- 歌词会通过JS动态插入 -->
        </div>
      </div>
      <div class="mt-6 relative h-1 bg-gray-200 rounded-full overflow-hidden">
        <div id="progress-bar" class="absolute top-0 left-0 h-full bg-love transition-all duration-300" style="width: 0%"></div>
      </div>
      <div class="flex justify-between text-xs text-gray-500 mt-2">
        <span id="current-time">00:00</span>
        <span id="total-time">00:00</span>
      </div>
    </div>
  </section>

  <!-- 时间线文案 -->
  <section class="relative z-10 max-w-4xl mx-auto px-6 mb-20 opacity-0" id="love-story">
    <h2 class="font-romantic text-[clamp(1.8rem,4vw,2.5rem)] text-love-dark text-center mb-10">
      我们的恋爱时间线
    </h2>
    <div class="space-y-8">
      <!-- 相识 -->
      <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-pink-100 transform transition-all hover:-translate-y-2 hover:shadow-xl">
        <div class="flex flex-col md:flex-row items-center gap-6">
          <div class="w-24 h-24 rounded-full bg-love-light flex items-center justify-center shrink-0">
            <span class="font-romantic text-love-dark text-xl font-bold">2022.8.15</span>
          </div>
          <div>
            <h3 class="font-romantic text-xl text-love-dark mb-2">初见·夏末的风</h3>
            <p class="text-gray-700 leading-relaxed">
              那天的风很温柔，像极了你的笑容。第一次见面，你穿着白色连衣裙，站在咖啡馆的窗边，阳光洒在你身上，那一刻我就在想："原来小说里的一见钟情，真的会发生。"
            </p>
          </div>
        </div>
      </div>
      
      <!-- 确认关系 -->
      <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-pink-100 transform transition-all hover:-translate-y-2 hover:shadow-xl">
        <div class="flex flex-col md:flex-row items-center gap-6">
          <div class="w-24 h-24 rounded-full bg-love-light flex items-center justify-center shrink-0">
            <span class="font-romantic text-love-dark text-xl font-bold">2022.8.21</span>
          </div>
          <div>
            <h3 class="font-romantic text-xl text-love-dark mb-2">确认·心动的答案</h3>
            <p class="text-gray-700 leading-relaxed">
              六天的试探与心动，在那个傍晚有了答案。我紧张地问你"要不要做我女朋友"，你红着脸点头的瞬间，我觉得整个世界都亮了。从此，我的未来规划里，全是你的身影。
            </p>
          </div>
        </div>
      </div>
      
      <!-- 三周年 -->
      <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-pink-100 transform transition-all hover:-translate-y-2 hover:shadow-xl">
        <div class="flex flex-col md:flex-row items-center gap-6">
          <div class="w-24 h-24 rounded-full bg-love-light flex items-center justify-center shrink-0">
            <span class="font-romantic text-love-dark text-xl font-bold">2025.8.21</span>
          </div>
          <div>
            <h3 class="font-romantic text-xl text-love-dark mb-2">三周年·余生的序章</h3>
            <p class="text-gray-700 leading-relaxed">
              三年时光，足以让一棵小树苗长成绿荫。我们一起看过凌晨的日出，熬过深夜的疲惫，分享过成功的喜悦，也分担过失落的沮丧。谢谢你，让我在这兵荒马乱的世界里，有了一个可以安心停靠的港湾。
            </p>
          </div>
        </div>
      </div>
      
      <!-- 生日祝福 -->
      <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-pink-100 transform transition-all hover:-translate-y-2 hover:shadow-xl">
        <div class="flex flex-col md:flex-row items-center gap-6">
          <div class="w-24 h-24 rounded-full bg-love-light flex items-center justify-center shrink-0">
            <span class="font-romantic text-love-dark text-xl font-bold">农历九月廿五</span>
          </div>
          <div>
            <h3 class="font-romantic text-xl text-love-dark mb-2">生日·你的专属星辰</h3>
            <p class="text-gray-700 leading-relaxed">
              每年的这一天，都是我最期待的"专属节日"。你是上天赐给我最珍贵的礼物，你的存在让我的世界充满色彩。愿往后的每一个生日，我都能在你身边，陪你吹蜡烛、切蛋糕，看你笑靥如花。
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 照片区域 -->
  <section class="relative z-10 max-w-5xl mx-auto px-6 mb-20 opacity-0" id="photos">
    <h2 class="font-romantic text-[clamp(1.8rem,4vw,2.5rem)] text-love-dark text-center mb-10">
      我们的浪漫碎片
    </h2>
    <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
      <div class="rounded-xl overflow-hidden shadow-xl transform transition-transform hover:scale-105 hover:shadow-2xl group relative">
        <img src="https://picsum.photos/id/1025/600/600" alt="我们的回忆" class="w-full h-64 object-cover transition-transform duration-500 group-hover:scale-110">
        <div class="absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
          <span class="text-white font-romantic text-xl">第一次约会</span>
        </div>
      </div>
      <div class="rounded-xl overflow-hidden shadow-xl transform transition-transform hover:scale-105 hover:shadow-2xl group relative">
        <img src="https://picsum.photos/id/1062/600/600" alt="我们的回忆" class="w-full h-64 object-cover transition-transform duration-500 group-hover:scale-110">
        <div class="absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
          <span class="text-white font-romantic text-xl">周年旅行</span>
        </div>
      </div>
      <div class="rounded-xl overflow-hidden shadow-xl transform transition-transform hover:scale-105 hover:shadow-2xl group relative">
        <img src="https://picsum.photos/id/1082/600/600" alt="我们的回忆" class="w-full h-64 object-cover transition-transform duration-500 group-hover:scale-110">
        <div class="absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
          <span class="text-white font-romantic text-xl">一起看海</span>
        </div>
      </div>
      <div class="rounded-xl overflow-hidden shadow-xl transform transition-transform hover:scale-105 hover:shadow-2xl group relative">
        <img src="https://picsum.photos/id/177/600/600" alt="我们的回忆" class="w-full h-64 object-cover transition-transform duration-500 group-hover:scale-110">
        <div class="absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
          <span class="text-white font-romantic text-xl">跨年烟火</span>
        </div>
      </div>
      <div class="rounded-xl overflow-hidden shadow-xl transform transition-transform hover:scale-105 hover:shadow-2xl group relative">
        <img src="https://picsum.photos/id/237/600/600" alt="我们的回忆" class="w-full h-64 object-cover transition-transform duration-500 group-hover:scale-110">
        <div class="absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
          <span class="text-white font-romantic text-xl">春日漫步</span>
        </div>
      </div>
      <div class="rounded-xl overflow-hidden shadow-xl transform transition-transform hover:scale-105 hover:shadow-2xl group relative">
        <img src="https://picsum.photos/id/325/600/600" alt="我们的回忆" class="w-full h-64 object-cover transition-transform duration-500 group-hover:scale-110">
        <div class="absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
          <span class="text-white font-romantic text-xl">日常碎片</span>
        </div>
      </div>
    </div>
    <p class="text-center text-gray-500 mt-6 text-sm">
      （点击照片可替换为我们的回忆，推荐使用路过图床获取图片链接）
    </p>
  </section>

  <!-- 情话区域 -->
  <section class="relative z-10 max-w-4xl mx-auto px-6 mb-20 opacity-0" id="love-quotes">
    <h2 class="font-romantic text-[clamp(1.8rem,4vw,2.5rem)] text-love-dark text-center mb-10">
      藏在时光里的情话
    </h2>
    <div class="grid grid-cols-1 gap-6">
      <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-pink-100 transform transition-all hover:-translate-y-2 hover:shadow-xl">
        <p class="font-romantic text-[clamp(1rem,2vw,1.2rem)] text-gray-700 italic text-center">
          "和你在一起的每一天，都是我生命里最温暖的章节。"
        </p>
        <p class="text-right text-love text-sm mt-4">—— 恋爱一周年</p>
      </div>
      <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-pink-100 transform transition-all hover:-translate-y-2 hover:shadow-xl">
        <p class="font-romantic text-[clamp(1rem,2vw,1.2rem)] text-gray-700 italic text-center">
          "你是我疲惫生活里的英雄梦想，也是我平淡岁月里的星辰大海。"
        </p>
        <p class="text-right text-love text-sm mt-4">—— 某个失眠的夜晚</p>
      </div>
      <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-pink-100 transform transition-all hover:-translate-y-2 hover:shadow-xl">
        <p class="font-romantic text-[clamp(1rem,2vw,1.2rem)] text-gray-700 italic text-center">
          "未来的路还很长，但只要身边是你，我就有勇气走下去。"
        </p>
        <p class="text-right text-love text-sm mt-4">—— 三周年纪念</p>
      </div>
      <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-pink-100 transform transition-all hover:-translate-y-2 hover:shadow-xl">
        <p class="font-romantic text-[clamp(1rem,2vw,1.2rem)] text-gray-700 italic text-center">
          "谢谢你出现在我的生命里，让我知道被爱的感觉如此美好。"
        </p>
        <p class="text-right text-love text-sm mt-4">—— 你的生日</p>
      </div>
    </div>
  </section>

  <footer class="relative z-10 py-8 text-center text-gray-500 text-sm">
    <p>用爱编织的时光 &copy; 2025 · 纪念我们的第三年</p>
    <button id="musicToggle" class="mt-4 text-love hover:text-love-dark transition-colors">
      <i class="fa fa-pause mr-1"></i> 暂停音乐
    </button>
  </footer>

  <script>
    // 修复可能的加载问题，添加页面加载提示
    document.addEventListener('DOMContentLoaded', () => {
      // 精准歌词时间点（确保24秒后开始对应歌词）
      const lyrics = [
        { time: 3, text: "塞纳河畔 左岸的咖啡" },
        { time: 5.5, text: "我手一杯 品尝你的美" },
        { time: 8.5, text: "留下唇印的嘴" },
        { time: 11.5, text: "" },
        { time: 12, text: "花店玫瑰 名字写错谁" },
        { time: 14.5, text: "告白气球 风吹到对街" },
        { time: 17.5, text: "微笑在天上飞" },
        { time: 20.5, text: "" },
        { time: 24, text: "你说你有点难追 想让我知难而退" },
        { time: 29, text: "礼物不需挑最贵 只要香榭的落叶" },
        { time: 34, text: "喔 营造浪漫的约会 不害怕搞砸一切" },
        { time: 39, text: "拥有你就拥有 全世界" },
        { time: 43, text: "" },
        { time: 44, text: "亲爱的 爱上你 从那天起" },
        { time: 49, text: "甜蜜的很轻易" },
        { time: 52, text: "亲爱的 别任性 你的眼睛" },
        { time: 57, text: "在说我愿意" },
        { time: 61, text: "" },
        { time: 62, text: "塞纳河畔 左岸的咖啡" },
        { time: 64.5, text: "我手一杯 品尝你的美" },
        { time: 67.5, text: "留下唇印的嘴" },
        { time: 70.5, text: "" },
        { time: 71, text: "花店玫瑰 名字写错谁" },
        { time: 73.5, text: "告白气球 风吹到对街" },
        { time: 76.5, text: "微笑在天上飞" },
        { time: 79.5, text: "" },
        { time: 80, text: "你说你有点难追 想让我知难而退" },
        { time: 85, text: "礼物不需挑最贵 只要香榭的落叶" },
        { time: 90, text: "喔 营造浪漫的约会 不害怕搞砸一切" },
        { time: 95, text: "拥有你就拥有 全世界" },
        { time: 99, text: "" },
        { time: 100, text: "亲爱的 爱上你 从那天起" },
        { time: 105, text: "甜蜜的很轻易" },
        { time: 108, text: "亲爱的 别任性 你的眼睛" },
        { time: 113, text: "在说我愿意" },
        { time: 117, text: "" },
        { time: 124, text: "亲爱的 爱上你 恋爱日记" },
        { time: 129, text: "飘香水的回忆" },
        { time: 132, text: "一整瓶 的梦境 全都有你" },
        { time: 137, text: "搅拌在一起" },
        { time: 141, text: "" },
        { time: 148, text: "亲爱的 别任性 你的眼睛" },
        { time: 153, text: "在说我愿意" }
      ];

      // 创建花瓣装饰
      function createPetals() {
        const container = document.getElementById('petals-container');
        const petals = [
          'https://picsum.photos/id/106/20/20',
          'https://picsum.photos/id/107/20/20',
          'https://picsum.photos/id/108/20/20',
          'https://picsum.photos/id/109/20/20',
          'https://picsum.photos/id/110/20/20'
        ];
        
        setInterval(() => {
          const petal = document.createElement('div');
          petal.className = 'petal float';
          petal.style.left = `${Math.random() * 100}vw`;
          petal.style.top = '100vh';
          petal.style.width = `${15 + Math.random() * 25}px`;
          petal.style.height = petal.style.width;
          petal.style.backgroundImage = `url(${petals[Math.floor(Math.random() * petals.length)]})`;
          petal.style.animationDuration = `${8 + Math.random() * 15}s`;
          petal.style.zIndex = '0';
          
          container.appendChild(petal);
          
          setTimeout(() => {
            petal.remove();
          }, 20000);
        }, 1500);
      }

      // 创建漂浮爱心效果
      function createHearts() {
        const container = document.getElementById('hearts-container');
        const colors = ['#FF69B4', '#FFB6C1', '#DDA0DD', '#FFC0CB', '#FF1493'];
        
        setInterval(() => {
          const heart = document.createElement('div');
          heart.innerHTML = '<i class="fa fa-heart"></i>';
          heart.className = 'absolute text-2xl opacity-70 float';
          heart.style.left = `${Math.random() * 100}vw`;
          heart.style.top = '100vh';
          heart.style.color = colors[Math.floor(Math.random() * colors.length)];
          heart.style.animationDuration = `${5 + Math.random() * 10}s`;
          heart.style.opacity = Math.random() * 0.7 + 0.3;
          heart.style.fontSize = `${12 + Math.random() * 24}px`;
          heart.style.zIndex = '0';
          
          container.appendChild(heart);
          
          setTimeout(() => {
            heart.remove();
          }, 15000);
        }, 800);
      }

      // 创建漂浮气泡效果
      function createBubbles() {
        const container = document.getElementById('bubbles-container');
        
        setInterval(() => {
          const bubble = document.createElement('div');
          bubble.className = 'absolute rounded-full bg-white/30 backdrop-blur-sm float';
          bubble.style.left = `${Math.random() * 100}vw`;
          bubble.style.top = '100vh';
          bubble.style.width = `${10 + Math.random() * 30}px`;
          bubble.style.height = bubble.style.width;
          bubble.style.animationDuration = `${8 + Math.random() * 15}s`;
          bubble.style.zIndex = '0';
          
          container.appendChild(bubble);
          
          setTimeout(() => {
            bubble.remove();
          }, 20000);
        }, 1200);
      }
      
      // 滚动动画设置
      function setupScrollAnimations() {
        const sections = ['song-info', 'lyrics-section', 'love-story', 'photos', 'love-quotes'];
        
        // 简单的降级方案，如果IntersectionObserver不支持
        if (!('IntersectionObserver' in window)) {
          sections.forEach(sectionId => {
            const section = document.getElementById(sectionId);
            if (section) section.classList.add('slide-up');
          });
          return;
        }
        
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('slide-up');
              observer.unobserve(entry.target);
            }
          });
        }, { threshold: 0.1 });
        
        sections.forEach(sectionId => {
          const section = document.getElementById(sectionId);
          if (section) {
            observer.observe(section);
          }
        });
      }
      
      // 歌词同步设置
      function setupLyrics() {
        const music = document.getElementById('bgMusic');
        const lyricsWrapper = document.getElementById('lyrics-wrapper');
        const lyricsContainer = document.getElementById('lyrics-container');
        const progressBar = document.getElementById('progress-bar');
        const currentTimeEl = document.getElementById('current-time');
        const totalTimeEl = document.getElementById('total-time');
        
        // 渲染歌词
        lyrics.forEach((lyric, index) => {
          const lyricEl = document.createElement('div');
          lyricEl.className = `py-3 text-gray-700 font-lyric text-[clamp(1rem,2vw,1.2rem)] opacity-30 transition-opacity`;
          lyricEl.textContent = lyric.text;
          lyricEl.dataset.index = index;
          lyricsWrapper.appendChild(lyricEl);
        });
        
        const lyricElements = document.querySelectorAll('#lyrics-wrapper > div');
        let currentIndex = -1;
        
        // 音频元数据加载完成后更新总时长
        music.addEventListener('loadedmetadata', () => {
          const totalTime = music.duration;
          totalTimeEl.textContent = formatTime(totalTime);
        });
        
        // 音频播放进度更新时同步歌词
        music.addEventListener('timeupdate', () => {
          const currentTime = music.currentTime;
          currentTimeEl.textContent = formatTime(currentTime);
          progressBar.style.width = `${(currentTime / music.duration) * 100}%`;
          
          // 匹配当前时间对应的歌词
          for (let i = 0; i < lyrics.length; i++) {
            if (lyrics[i].time <= currentTime && 
                (i === lyrics.length - 1 || lyrics[i + 1].time > currentTime)) {
              if (i !== currentIndex) {
                // 更新上一句歌词样式
                if (currentIndex !== -1) {
                  lyricElements[currentIndex].classList.remove('opacity-100', 'text-love-dark', 'font-bold', 'lyric-active');
                  lyricElements[currentIndex].classList.add('opacity-30', 'text-faded');
                }
                
                // 更新当前句歌词样式
                currentIndex = i;
                lyricElements[currentIndex].classList.remove('opacity-30', 'text-faded');
                lyricElements[currentIndex].classList.add('opacity-100', 'text-love-dark', 'font-bold', 'lyric-active');
                
                // 滚动歌词到可视区域
                const containerHeight = lyricsContainer.clientHeight;
                const lyricHeight = lyricElements[currentIndex].clientHeight;
                const scrollTop = (currentIndex * lyricHeight) - (containerHeight / 2) + (lyricHeight / 2);
                lyricsWrapper.style.transform = `translateY(-${scrollTop}px)`;
              }
              break;
            }
          }
        });
      }
      
      // 格式化时间为 MM:SS 格式
      function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      }
      
      // 音乐播放控制
      function setupMusic() {
        const music = document.getElementById('bgMusic');
        const toggleBtn = document.getElementById('musicToggle');
        const playTip = document.getElementById('playTip');
        const introTip = document.getElementById('intro-tip');
        let isPlaying = false;
        let hasInteracted = false;

        // 尝试自动播放音乐
        function tryAutoPlay() {
          music.play().then(() => {
            isPlaying = true;
            hasInteracted = true;
            playTip.style.display = 'none';
            introTip.style.display = 'block';
            setTimeout(() => {
              introTip.style.display = 'none';
            }, 3000);
            toggleBtn.innerHTML = '<i class="fa fa-pause mr-1"></i> 暂停音乐';
          }).catch(err => {
            console.log('需用户交互后播放:', err);
            playTip.style.display = 'block';
          });
        }

        tryAutoPlay();

        // 点击页面任意位置播放音乐（针对浏览器自动播放限制）
        document.addEventListener('click', () => {
          if (!hasInteracted) {
            music.play().then(() => {
              isPlaying = true;
              hasInteracted = true;
              playTip.style.display = 'none';
              introTip.style.display = 'block';
              setTimeout(() => {
                introTip.style.display = 'none';
              }, 3000);
              toggleBtn.innerHTML = '<i class="fa fa-pause mr-1"></i> 暂停音乐';
            }).catch(err => {
              console.log('点击后播放失败:', err);
              alert('音乐播放失败，请检查网络或手动播放背景音乐');
            });
          }
        }, { once: true });

        // 音乐播放/暂停切换
        toggleBtn.addEventListener('click', () => {
          if (isPlaying) {
            music.pause();
            toggleBtn.innerHTML = '<i class="fa fa-music mr-1"></i> 播放音乐';
          } else {
            music.play();
            toggleBtn.innerHTML = '<i class="fa fa-pause mr-1"></i> 暂停音乐';
          }
          isPlaying = !isPlaying;
        });
      }
      
      // 照片替换功能
      function setupPhotoReplacement() {
        const photos = document.querySelectorAll('#photos img');
        photos.forEach(photo => {
          photo.addEventListener('click', () => {
            const guide = "请先上传照片到路过图床（https://imgtu.com/），获取图片链接后粘贴在此处";
            const newSrc = prompt(guide);
            if (newSrc && newSrc.includes('imgtu.com')) {
              photo.src = newSrc;
              alert('照片替换成功！');
            } else if (newSrc) {
              alert('请使用路过图床的图片链接（链接需包含imgtu.com）');
            }
          });
        });
      }
      
      // 初始化所有功能
      try {
        createPetals();
        createHearts();
        createBubbles();
        setupScrollAnimations();
        setupLyrics();
        setupMusic();
        setupPhotoReplacement();
      } catch (error) {
        console.error('初始化错误:', error);
        alert('页面加载时出现错误，请刷新页面重试');
      }
    });
  </script>
</body>
</html>
